<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Trend Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="app-bg">

    <!-- User info and logout -->
    <div class="user-info">
        Welcome, <strong>{{ session['user'] }}</strong> |
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>

    <div class="app-container">

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <h1>Bitcoin Price Trend</h1>

        <!-- Currency + Timeframe Form -->
        <form action="/" method="post" class="currency-form">
            <label for="currency">Select Currency:</label>
            <select name="currency" id="currency">
                <option value="usd" {% if currency == 'usd' %}selected{% endif %}>USD</option>
                <option value="inr" {% if currency == 'inr' %}selected{% endif %}>INR</option>
                <option value="eur" {% if currency == 'eur' %}selected{% endif %}>EUR</option>
                <option value="jpy" {% if currency == 'jpy' %}selected{% endif %}>JPY</option>
            </select>

            <label for="timeframe">Select Timeframe:</label>
            <select name="timeframe" id="timeframe">
                <option value="day" {% if timeframe == 'day' %}selected{% endif %}>Day</option>
                <option value="week" {% if timeframe == 'week' %}selected{% endif %}>Week</option>
                <option value="month" {% if timeframe == 'month' %}selected{% endif %}>Month</option>
            </select>

            <button type="submit">Show Results</button>
        </form>

        {% if alert %}
        <div class="alert-box">⚠️ {{ alert }}</div>
        {% endif %}

        {% if show_chart and chart_html %}
        <div class="chart-section">
            <h2>BTC Trend ({{ currency.upper() }} - {{ timeframe.capitalize() }})</h2>
            {{ chart_html|safe }}
        </div>
        {% else %}
        <p>No trend data available for this currency/timeframe.</p>
        {% endif %}

        {% if data %}
        <h2>Recent BTC Price Data</h2>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Price</th>
                    <th>Currency</th>
                </tr>
            </thead>
            <tbody>
            {% for row in data %}
                <tr>
                    <td>{{ row.timestamp }}</td>
                    <td>{{ row.value }}</td>
                    <td>{{ row.currency.upper() }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endif %}

    </div>
</body>
</html>
